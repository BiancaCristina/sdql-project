version: "3.7"

services:

  grpc-server:
    build:
      context: .
      dockerfile: Dockerfile-server
    ports:
      - "8080:8080"
    networks:
      envoymesh:
        aliases:
          - kv-backend-service

  grpc-client:
    build:
      context: .
      dockerfile: Dockerfile-client
    environment:
      - CLIENT_PROXY=http://kv-client-proxy:9090
    networks:
      - envoymesh
    stdin_open: true

  grpc-client-proxy:
    build:
      context: .
      dockerfile: Dockerfile-client-proxy
    networks:
      envoymesh:
        aliases:
          - kv-client-proxy
    ports:
      - "9090:9090"

networks:
  envoymesh: {}
